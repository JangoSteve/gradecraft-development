!!! 5
%html(lang="en")
  %head
    %meta(charset="utf-8")
    %meta(name="viewport" content="width=device-width, initial-scale=1")
    %title
      = "#{yield :title} - " if content_for? :title
      = current_course.try(:name) || 'GradeCraft'
    = csrf_meta_tags
    /[if lt IE 9]
      = javascript_include_tag "https://html5shim.googlecode.com/svn/trunk/html5.js"
    = stylesheet_link_tag "application", :media => "all"
    = javascript_include_tag 'application'
    %script(src="/ckeditor/ckeditor.js")
    %script(src="/ckeditor/adapters/jquery.js")
    %script(src="/highcharts/js/highcharts.src.js")
    %script(src="/highcharts/js/highcharts-more.src.js")
    = yield(:head)
  %body
    .navbar.navbar-fixed-top.navbar-inverse
      .navbar-inner
        %div.col-lg-6.col-sm-12.col-12
          %a.brand(href="/dashboard")
            - if current_course
              #{current_course.name}
            - else
              GradeCraft
        %div.pull-right.col-lg-4.col-sm-12.col-12
          - if current_user
            %div{:class => 'btn-group pull-right'}
              %a{:class => 'username btn dropdown-toggle', "data-toggle" => 'dropdown', :href => '#' }
                = current_user.public_name
                %i.caret
              %ul{:class => 'dropdown-menu well'}
                %li= link_to "My Account", edit_profile_users_path
                %li= link_to "Logout", :logout
          - else   
            %div{:class => 'btn-group pull-right'}
              %a{:class => 'btn btn-xs btn-primary dropdown-toggle', "data-toggle" => 'dropdown', :href => '#' }
                Log In 
                %span{:class => 'caret'}
              %ul{:class => 'dropdown-menu dropdown form-inline login'}
                = simple_form_for User.new, :url => user_sessions_path do |f|
                  %li= f.input :email, :label => false, :html => { :class => "col-lg-12"}
                  %li= f.input :password, :label => false
                  %li= submit_tag "Log in", :class => 'dropmenu btn btn-small pull-right', :alt => "Log in"
                %div.spacer
                %div.divider.clear
                = link_to 'Forget your password?', new_user_session_path, :class => "forgot"
    
    %div#page.bkg.row(class="#{'logged_out col-lg-10 col-lg-offset-1 rounded' if ! current_user}")
      - if current_user && current_user.is_staff? &&! current_page?(:controller => 'users', :action => 'predictor')
        %div.col-lg-3.col-sm-3
          %div.sidebar-nav-fixed
            = render 'layouts/admin_subnav'
        %div.col-lg-9.col-sm-9
          = render 'layouts/alerts'
          - if @title
            %h5.pageTitle= @title
          = yield
      - elsif current_user && current_user.is_staff? && current_page?(:controller => 'users', :action => 'predictor')
        %div.col-lg-12
          %div.col-lg-3
            %div.sidebar-nav-fixed.well
              %ul.nav.nav-list
                %li.nav-header Quick Menu
                %li= link_to "Students", students_users_path
                %li= link_to "Assignments", assignments_path
                %li= link_to "Badges", badges_path
                %li= link_to "Settings", edit_course_path(current_course)
          %div.col-lg-9
            = render 'layouts/alerts'
            = yield
      - elsif current_user && current_user.is_student?
        %div.col.col-lg-12#page
          = render 'layouts/alerts'
          = yield
      - else
        = render 'layouts/alerts'
        = yield

    %footer.col-lg-10(class="#{'logged_out col-lg-10 col-lg-offset-1 rounded' if ! current_user}")
      %div.col-lg-3
        %h5 &copy; 2012-13 Regents of the University of Michigan
      %div.col-lg-2.col-sm-12
        %h5 Explore
        %ul
          %li= link_to "Features", features_path
          %li= link_to "See the Demo", "https://gradecraft.herokuapp.com"
      %div.col-lg-2.col-sm-12
        %h5 Using GradeCraft
        %ul
          %li= link_to "Apply to Use", using_gradecraft_path
          %li= link_to "Documentation" 
          %li= link_to "Submit a Bug", submit_a_bug_path
      %div.col-lg-2.col-sm-12
        %h5 About 
        %ul
          %li= link_to "Research", research_path
          %li= link_to "People", people_path
          %li= link_to "Codebase", "https://github.com/bellotastudios/gradecraft"
      %div.col-lg-2.col-sm-12
        %h5 Talk to Us
        %ul
          %li= link_to "Email", "mailto:cait@gradecraft.com"
          %li= link_to "News", news_path
          %li= link_to "Twitter", "https://twitter.com/gradecraft"

   
    - if current_user.try(:is_admin?)
      .navbar.navbar-fixed-bottom.navbar-inverse
        .navbar-inner
          %div.course
            = "Current Course: "
            = form_tag change_current_course_path, :class => 'btn btn-tiny' do 
              = select_tag 'course_id', options_from_collection_for_select(current_user.courses, 'id', 'name', current_course.id) 
