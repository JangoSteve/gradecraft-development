= content_nav_for Assignment do
  - if current_user.is_staff?
    %li= link_to "Create a New #{term_for :assignment}", new_assignment_path, :class => "btn btn-tiny btn-info"
  - else
    %li= link_to "My Dashboard", dashboard_path, :class => "btn btn-tiny btn-info"

.col-lg-12
  %h3= @title

- current_course_data.by_assignment_type.each do |assignment_type, assignments|
  .col-lg-12
    %h3
      = link_to assignment_type.name, assignment_type
      - if current_user.is_staff?
        = link_to "[Edit]", edit_assignment_type_path(assignment_type)
  %table.table.simpleTable.table-striped
    %thead
      %tr
        %th.sortable{"data-sort" => "string"} Name
        %th.sortable{"data-sort" => "date"} Open Date
        %th.sortable{"data-sort" => "date"} Due Date
        %th.sortable{"data-sort" => "date"} Accepted Until
        %th.sortable{"data-sort" => "int"} Total Points
        - if current_user.is_staff?
          - if assignment_type.name == "Attendance"
            %th.sortable{"data-sort" => "int"} Attendance Rate
          %th.sortable{"data-sort" => "int"} Average
          %th.sortable{"data-sort" => "int"} Range
          %th(colspan="4")
        - else
          %th
          %th
          %th
          %th
    %tbody
      - assignments.each do |assignment|
        - if assignment.visible? || (current_user.is_student? && current_student_data.grade_released_for_assignment?(assignment)) || current_user.is_staff?
          %tr
            %td= link_to assignment.name, assignment
            %td= assignment.try(:open_at)
            %td= assignment.try(:due_at) || "Ongoing"
            %td
              - if assignment.accepts_submissions?
                = assignment.try(:accepts_submissions_until)
            %td= points assignment.point_total
            - if current_user.is_staff? && assignment_type.name == "Attendance"
              %td
                - if !assignment.future?
                  = "#{assignment.attendance_rate(current_course)} %"
            - if current_user.is_staff?
              %td= number_with_delimiter(assignment.average, :delimiter => ',')
              %td= "#{number_with_delimiter(assignment.low_score, :delimiter => ',')} - #{number_with_delimiter(assignment.high_score, :delimiter => ',')}"
              %td= link_to 'Quick Grade',  mass_grade_assignment_path(assignment), :class => 'btn btn-tiny btn-success'
              %td
                - if assignment.accepts_submissions? && assignment.submissions.present?
                  = link_to "Grade #{ assignment.submissions.count } Submissions", assignment_submissions_path(assignment), :class => "btn btn-tiny btn-success"
                - else
                  = link_to "Grade", assignment_path(assignment), :class => "btn btn-tiny btn-success"
              %td= link_to "Edit", edit_assignment_path(assignment), :class => 'btn btn-tiny btn-info'
              %td= link_to "Delete", assignment_path(assignment), :class => 'btn btn-tiny btn-warning', :data => { confirm: 'Are you sure?' }, :method => :delete
            - else
              - if assignment.accepts_submissions? && assignment.has_groups?
                - if current_student.group_for_assignment(assignment)
                  %td= link_to "See Group", group_path(current_student.group_for_assignment(assignment)), :class => "btn btn-primary btn-xs"
                  - if assignment.accepts_submissions?
                    = render "students/group_submissions", assignment: assignment, group: current_student.group_for_assignment(assignment)
                - else
                  %td= link_to "Create a Group", new_group_path, :class => "btn btn-primary btn-xs"
              - elsif assignment.accepts_submissions? && assignment.is_individual?
                - current_student.submission_for_assignment(assignment).tap do |submission|
                  - if submission
                    %td= link_to "See Submission", assignment_submission_path(assignment.id, submission, :student_id => current_student.id), :class => 'btn btn-tiny btn-success'
                    %td
                    %td
                    %td
                  - else
                    %td= link_to "Submit", new_assignment_submission_path(assignment, @submission, :user_id => current_student.id, :student_type => "User"), :class => 'btn btn-tiny btn-success'
                    %td
                    %td
                    %td
              - else
                %td
                %td
                %td
