= form_tag edit_status_grades_assignment_path @assignment do
  %table.responsive.simpleTable
    %thead
      %tr
        - if @assignment.release_necessary?
          %th
            .btn-group
              %button.select-all.btn.btn-xs.btn-info= "Check"
              %button.select-none.btn.btn-xs.btn-info= "Uncheck"
        %th.sortable{"data-sort" => "string"}= term_for :student
        %th.sortable{"data-sort" => "int"} Raw Score
        - if @assignment.assignment_type.student_weightable?
          %th.sortable{"data-sort" => "int"} Multiplied Score
        - if @assignment.has_levels?
          %th{"data-sort" => "string"} Level
        - if @assignment.release_necessary?
          %th.sortable{"data-sort" => "string"} Status
        - if @assignment.accepts_submissions?
          %th.sortable{"data-sort" => "int"} Submission
        %th
    %tbody
      - if @team
        - students = current_course_data.students_for_team(@team)
      - else
        - students = current_course_data.students
      - students.each do |student|
        - grade = current_course_data.grade_for_student_and_assignment(student, @assignment)
        %tr
          - if @assignment.release_necessary?
            %td
              - if grade.is_graded?
                = check_box_tag "grade_ids[]", grade.id
          %td= link_to student.name, student_path(student)
          %td{:data => { :"sort-value" => "#{grade.raw_score}"} }= points grade.raw_score if grade.status?
          - if @assignment.assignment_type.student_weightable?
            %td
              = points grade.score if grade.status?
          - if @assignment.has_levels?
            %td
              = @assignment.grade_level(grade) if grade.status?
          - if @assignment.release_necessary?
            %td
              - if grade.is_released?
                = "Released"
              - elsif grade.is_graded?
                = "Graded"

          - if @assignment.accepts_submissions?
            %td
              - student.submissions.where(:assignment_id => @assignment).each do |submission|
                - if submission && grade
                  = link_to "See Submission", assignment_submission_path(@assignment.id, submission, :grade_id => grade.id, :student_id => student.id), :class => 'button tiny radius'
                - elsif submission
                  = link_to "See Submission", assignment_submission_path(@assignment.id, submission.id, :student_id => student.id), :class => 'button tiny radius'
                - else
                  = link_to "Submit", new_assignment_submission_path(@assignment, @submission, :user_id => student.id, :student_type => "User"), :class => 'button tiny radius'
          %td
            - if grade.is_graded? || grade.is_released?
              = link_to "Edit Grade", edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button tiny radius'
            - else
              = link_to 'Grade', edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button tiny radius'

  - if @assignment.release_necessary? && @assignment.grades.present?
    .small-12
      = submit_tag "Update Selected Grade Statuses", :class => "button tiny radius"
