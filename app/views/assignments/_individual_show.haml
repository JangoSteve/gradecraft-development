- if current_course.has_teams? && @assignment.is_individual?
  .small-12.medium-6.large-4.right.columns.form_buttons
    = form_tag assignment_path(@assignment), :name => "see_team", :onchange => ("javascript: document.see_team.submit();"), :method => :get do
      = hidden_field_tag :assignment_id, @assignment.id
      %label.sr-only{:for => "team_id"}
        Select Team
      = select_tag :team_id, options_for_select(current_course.teams.map { |t| [t.name, t.id] }, @team.try(:id)), :prompt => "Select #{current_course.team_term}"

= form_tag edit_status_grades_assignment_path @assignment do
  .columns
    %table.responsive.nofeatures_default_last_name_dynatable
      %thead
        %tr
          %th{:scope => "col"} First Name
          %th{:scope => "col"} Last Name
          - if ! @assignment.assignment_type.student_weightable?
            %th{:scope => "col"} Score
          - elsif @assignment.assignment_type.student_weightable?
            %th{:scope => "col"} Raw Score
            %th{:scope => "col"} Multiplied Score
          - if @assignment.has_levels?
            %th{:scope => "col"} Level
          - if @assignment.release_necessary?
            %th{:scope => "col"} Status
          %th{:scope => "col"}
          - if @assignment.release_necessary?
            %th.center{"data-dynatable-no-sort" => "true"}
              %button.button.select-all.tiny= "Check All"
              %button.button.select-none.tiny= "Uncheck All"
      %tbody
        - @students.each do |student|
          - grade = current_course_data.grade_for_student_and_assignment(student, @assignment)
          %tr
            %td= link_to student.first_name, student_path(student)
            %td= link_to student.last_name, student_path(student)
            %td{:data => { :"sort-value" => "#{grade.raw_score}"} }= points grade.raw_score if grade.status?
            - if @assignment.assignment_type.student_weightable?
              %td
                - if student.weighted_assignments?
                  = points grade.score if grade.status?
                - else
                  = "(not yet assigned)"
            - if @assignment.release_necessary?
              %td= grade.status
            %td
              - if @assignment.accepts_submissions?
                - student.submissions.where(:assignment_id => @assignment).each do |submission|
                  - if submission && grade
                    .button-bar
                      - if submission.submission_files.present?
                        %i.fi-paperclip.right
                      %ul.button-group.radius.right
                        %li
                          %a{:href => assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'}
                            See Grade
                            %span.sr-only for #{student.first_name} #{student.last_name}
                        %li
                          %a{:href => edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'}
                            Edit Grade
                            %span.sr-only for #{student.first_name} #{student.last_name}
                  - elsif submission
                    .button-bar
                      - if submission.submission_files.present?
                        %i.fi-paperclip.right
                      %ul.button-group.radius.right
                        %li= link_to "Grade", edit_assignment_grade_path(@assignment.id, submission.id, :student_id => student.id), :class => 'button'
                    %i.fi-paperclip

                - if ! student.submissions.where(:assignment_id => @assignment).present?
                  - if grade && grade.status_is_graded_or_released?
                    .button-bar
                      %ul.button-group.radius.right
                        %li= link_to "See Grade", assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
                        %li= link_to "Edit Grade", edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
                  - else
                    .button-bar
                      %ul.button-group.radius.right
                        %li= link_to "Grade", edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
              - else
                - if grade && grade.status_is_graded_or_released?
                  .button-bar
                    %ul.button-group.radius.right
                      %li
                        %a{:href => assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'}
                          See Grade
                          %span.sr-only for #{student.first_name} #{student.last_name}
                      %li
                        %a{:href => edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'}
                          Edit Grade
                          %span.sr-only for #{student.first_name} #{student.last_name}
                - else
                  .button-bar
                    %ul.button-group.radius.right
                      %li
                        %a{:href => edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'}
                          Grade
                          %span.sr-only #{student.first_name} #{student.last_name}
                    %ul.button-group.round.right
                      %li
                        %a{:href => assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'}
                          See Grade
                          %span.sr-only for #{student.first_name} #{student.last_name}
                      %li
                        %a{:href => edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'}
                          Edit Grade
                          %span.sr-only for #{student.first_name} #{student.last_name}
            - if @assignment.release_necessary?
              %td
                - if grade.is_graded?
                  .center= check_box_tag "grade_ids[]", grade.id

  - if @auditing.present?

    %h4.subtitle Auditing #{term_for :students}

    .small-12.columns
      %table.responsive.nofeatures_default_last_name_dynatable
        %thead
          %tr
            %th{:scope => "col", :width => "8%"} First Name
            %th{:scope => "col", :width => "8%"} Last Name
            - if ! @assignment.assignment_type.student_weightable?
              %th{:scope => "col", :width => "8%"} Score
            - else
              %th{:scope => "col"} Raw Score
              %th{:scope => "col"} Multiplied Score
            - if @assignment.release_necessary?
              %th{:scope => "col"} Status
            %th{"data-dynatable-no-sort" => "true"} 
            - if @assignment.release_necessary?
              %th.center{"data-dynatable-no-sort" => "true", :width => "15%"}
                %button.button.select-all.tiny= "Check All"
                %button.button.select-none.tiny= "Uncheck All"
          
        %tbody
          - @auditing.each do |student|
            - grade = current_course_data.grade_for_student_and_assignment(student, @assignment)
            %tr
              %td= link_to student.first_name, student_path(student)
              %td= link_to student.last_name, student_path(student)
              %td{:data => { :"sort-value" => "#{grade.raw_score}"} }= points grade.raw_score if grade.status?
              - if @assignment.assignment_type.student_weightable?
                %td
                  = points grade.score if grade.status?
              - if @assignment.release_necessary?
                %td
                  - if grade.is_released?
                    = "Released"
                  - elsif grade.is_graded?
                    = "Graded"
              %td
                - if @assignment.accepts_submissions?
                  - student.submissions.where(:assignment_id => @assignment).each do |submission|
                    - if submission && grade
                      .button-bar
                        - if submission.submission_files.present?
                          %i.fi-paperclip.right
                        %ul.button-group.radius.right
                          %li= link_to "See Grade", assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
                          %li= link_to "Edit Grade", edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
                          
                    - elsif submission
                      .button-bar
                        - if submission.submission_files.present?
                          %i.fi-paperclip.right
                        %ul.button-group.radius.right
                          %li= link_to "Grade", edit_assignment_grade_path(@assignment.id, submission.id, :student_id => student.id), :class => 'button'
                      %i.fi-paperclip
                    - elsif grade && grade.status_is_graded_or_released?
                      .button-bar
                        %ul.button-group.radius.right
                          %li= link_to "See Grade", assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
                          %li= link_to "Edit Grade", edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
                    - elsif ! student.submissions.where(:assignment_id => @assignment).present?
                      .button-bar
                        %ul.button-group.radius.right
                          %li= link_to "Grade", edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
                - else
                  - if grade && grade.status_is_graded_or_released?
                    .button-bar
                      %ul.button-group.radius.right
                        %li= link_to "See Grade", assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
                        %li= link_to "Edit Grade", edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
                  - else
                    .button-bar
                      %ul.button-group.radius.right
                        %li= link_to "Grade", edit_assignment_grade_path(@assignment, :student_id => student.id), :class => 'button'
              - if @assignment.release_necessary?
                %td.text-center
                  - if grade.is_graded?
                    .center= check_box_tag "grade_ids[]", grade.id

    - if @assignment.release_necessary? && @assignment.grades.present?
      .small-12.columns
        .right.form_buttons
          = submit_tag "Update Selected Grade Statuses", :class => "button radius"
