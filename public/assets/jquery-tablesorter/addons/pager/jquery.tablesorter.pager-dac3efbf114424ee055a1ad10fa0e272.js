/*!
 * tablesorter pager plugin
 * updated 12/20/2012
 */
/*jshint browser:true, jquery:true, unused:false */
(function(e){"use strict";e.extend({tablesorterPager:new function(){this.defaults={container:null,ajaxUrl:null,ajaxProcessing:function(e){return[0,[],null]},output:"{startRow} to {endRow} of {totalRows} rows",updateArrows:!0,page:0,size:10,fixedHeight:!1,removeRows:!1,cssFirst:".first",cssPrev:".prev",cssNext:".next",cssLast:".last",cssGoto:".gotoPage",cssPageDisplay:".pagedisplay",cssPageSize:".pagesize",cssErrorRow:"tablesorter-errorRow",cssDisabled:"disabled",totalRows:0,totalPages:0,filteredRows:0,filteredPages:0};var t=this,n=function(t,n){var r="addClass",i="removeClass",s=t.cssDisabled,o=!!n,u=Math.min(t.totalPages,t.filteredPages);t.updateArrows&&(e(t.cssFirst+","+t.cssPrev,t.container)[o||t.page===0?r:i](s),e(t.cssNext+","+t.cssLast,t.container)[o||t.page===u-1?r:i](s))},r=function(t,r){var i,s,o,u,a,f=e(t).hasClass("hasFilters")&&!r.ajaxUrl;r.filteredRows=f?e(t).find("tbody tr:not(.filtered)").length:r.totalRows,r.filteredPages=f?Math.ceil(r.filteredRows/r.size):r.totalPages;if(Math.min(r.totalPages,r.filteredPages)>0){u=r.size*r.page>r.filteredRows,r.startRow=u?1:r.size*r.page+1,r.page=u?0:r.page,r.endRow=Math.min(r.filteredRows,r.totalRows,r.size*(r.page+1)),a=e(r.cssPageDisplay,r.container),o=r.output.replace(/\{(page|filteredRows|filteredPages|totalPages|startRow|endRow|totalRows)\}/gi,function(e){return{"{page}":r.page+1,"{filteredRows}":r.filteredRows,"{filteredPages}":r.filteredPages,"{totalPages}":r.totalPages,"{startRow}":r.startRow,"{endRow}":r.endRow,"{totalRows}":r.totalRows}[e]});if(a[0]){a[a[0].tagName==="INPUT"?"val":"html"](o);if(e(r.cssGoto,r.container).length){u="",s=Math.min(r.totalPages,r.filteredPages);for(i=1;i<=s;i++)u+="<option>"+i+"</option>";e(r.cssGoto,r.container).html(u).val(r.page+1)}}}n(r),r.initialized&&e(t).trigger("pagerComplete",r)},i=function(t,n){var r,i,s=e(t.tBodies[0]);n.fixedHeight&&(s.find("tr.pagerSavedHeightSpacer").remove(),i=e.data(t,"pagerSavedHeight"),i&&(r=i-s.height(),r>5&&e.data(t,"pagerLastSize")===n.size&&s.children("tr:visible").length<n.size&&s.append('<tr class="pagerSavedHeightSpacer remove-me" style="height:'+r+'px;"></tr>')))},s=function(t,n){var r=e(t.tBodies[0]);r.find("tr.pagerSavedHeightSpacer").remove(),e.data(t,"pagerSavedHeight",r.height()),i(t,n),e.data(t,"pagerLastSize",n.size)},o=function(t,n){if(!n.ajaxUrl){var r,i=e(t.tBodies).children("tr:not(."+t.config.cssChildRow+")"),s=i.length,o=n.page*n.size,u=o+n.size,a=0;for(r=0;r<s;r++)/filtered/.test(i[r].className)||(i[r].style.display=a>=o&&a<u?"":"none",a++)}},u=function(t,r){r.size=parseInt(e(r.cssPageSize,r.container).find("option[selected]").val(),10)||r.size,e.data(t,"pagerLastSize",r.size),n(r),r.removeRows||(o(t,r),e(t).bind("sortEnd.pager filterEnd.pager",function(){o(t,r)}))},a=function(t,n,s,o){if(typeof s.ajaxProcessing=="function"){var u,a,f,l,c,h=e(n),p=n.config,d=e(n.tBodies).filter(":not(."+p.cssInfoBlock+")"),v=h.find("thead th").length,m="",g='<tr class="'+s.cssErrorRow+" "+p.selectorRemove+'"><td style="text-align: center;" colspan="'+v+'">'+(o?o.message+" ("+o.name+")":"No rows found")+"</td></tr>",y=s.ajaxProcessing(t)||[0,[]],b=y[1]||[],w=b.length,E=y[2];if(w>0)for(u=0;u<w;u++){m+="<tr>";for(a=0;a<b[u].length;a++)m+="<td>"+b[u][a]+"</td>";m+="</tr>"}E&&E.length===v&&(f=h.hasClass("hasStickyHeaders"),c=h.find("."+(p.widgetOptions&&p.widgetOptions.stickyHeaders||"tablesorter-stickyheader")),l=h.find("tfoot tr:first").children(),h.find("th."+p.cssHeader).each(function(t){var n=e(this),r;n.find("."+p.cssIcon).length?(r=n.find("."+p.cssIcon).clone(!0),n.find(".tablesorter-header-inner").html(E[t]).append(r),f&&c.length&&(r=c.find("th").eq(t).find("."+p.cssIcon).clone(!0),c.find("th").eq(t).find(".tablesorter-header-inner").html(E[t]).append(r))):(n.find(".tablesorter-header-inner").html(E[t]),c.find("th").eq(t).find(".tablesorter-header-inner").html(E[t])),l.eq(t).html(E[t])})),h.find("thead tr."+s.cssErrorRow).remove(),o?h.find("thead").append(g):d.html(m),p.showProcessing&&e.tablesorter.isProcessing(n),h.trigger("update"),s.totalRows=y[0]||0,s.totalPages=Math.ceil(s.totalRows/s.size),r(n,s),i(n,s),s.initialized&&h.trigger("pagerChange",s)}s.initialized||(s.initialized=!0,e(n).trigger("pagerInitialized",s))},f=function(t,n){var r=l(t,n),i=t.config;r!==""&&(i.showProcessing&&e.tablesorter.isProcessing(t,!0),e(document).bind("ajaxError.pager",function(i,s,o,u){o.url===r&&(a(null,t,n,u),e(document).unbind("ajaxError.pager"))}),e.getJSON(r,function(r){a(r,t,n),e(document).unbind("ajaxError.pager")}))},l=function(t,n){var r=n.ajaxUrl?n.ajaxUrl.replace(/\{page\}/g,n.page).replace(/\{size\}/g,n.size):"",i=t.config.sortList,s=n.currentFilters||[],o=r.match(/\{sortList[\s+]?:[\s+]?([^}]*)\}/),u=r.match(/\{filterList[\s+]?:[\s+]?([^}]*)\}/),a=[];return o&&(o=o[1],e.each(i,function(e,t){a.push(o+"["+t[0]+"]="+t[1])}),r=r.replace(/\{sortList[\s+]?:[\s+]?([^\}]*)\}/g,a.length?a.join("&"):o)),u&&(u=u[1],e.each(s,function(e,t){t&&a.push(u+"["+e+"]="+encodeURIComponent(t))}),r=r.replace(/\{filterList[\s+]?:[\s+]?([^\}]*)\}/g,a.length?a.join("&"):u)),r},c=function(t,n,s){var u,a,f,l=document.createDocumentFragment(),c=n.length,h=s.page*s.size,p=h+s.size;if(c<1)return;s.initialized&&e(t).trigger("pagerChange",s);if(!s.removeRows)o(t,s);else{p>n.length&&(p=n.length),e(t.tBodies[0]).addClass("tablesorter-hidden"),e.tablesorter.clearTableBody(t);for(u=h;u<p;u++){f=n[u],c=f.length;for(a=0;a<c;a++)l.appendChild(f[a])}t.tBodies[0].appendChild(l),e(t.tBodies[0]).removeClass("tablesorter-hidden")}s.page>=s.totalPages&&m(t,s),r(t,s),s.isDisabled||i(t,s),e(t).trigger("applyWidgets")},h=function(t,r){r.ajax?n(r,!0):(r.isDisabled=!0,e.data(t,"pagerLastPage",r.page),e.data(t,"pagerLastSize",r.size),r.page=0,r.size=r.totalRows,r.totalPages=1,e("tr.pagerSavedHeightSpacer",t.tBodies[0]).remove(),c(t,t.config.rowsCopy,r)),e(r.container).find(r.cssPageSize+","+r.cssGoto).each(function(){e(this).addClass(r.cssDisabled)[0].disabled=!0})},p=function(t,n){if(n.isDisabled)return;var r=Math.min(n.totalPages,n.filteredPages);if(n.page<0||n.page>r-1)n.page=0;n.ajax?f(t,n):n.ajax||c(t,t.config.rowsCopy,n),e.data(t,"pagerLastPage",n.page),e.data(t,"pagerUpdateTriggered",!0),n.initialized&&e(t).trigger("pageMoved",n)},d=function(t,n,r){r.size=n,e.data(t,"pagerLastPage",r.page),e.data(t,"pagerLastSize",r.size),r.totalPages=Math.ceil(r.totalRows/r.size),p(t,r)},v=function(e,t){t.page=0,p(e,t)},m=function(e,t){t.page=Math.min(t.totalPages,t.filteredPages)-1,p(e,t)},g=function(e,t){t.page++,t.page>=Math.min(t.totalPages,t.filteredPages)-1&&(t.page=Math.min(t.totalPages,t.filteredPages)-1),p(e,t)},y=function(e,t){t.page--,t.page<=0&&(t.page=0),p(e,t)},b=function(t,n){h(t,n),e(n.container).hide(),t.config.appender=null,e(t).unbind("destroy.pager sortEnd.pager filterEnd.pager enable.pager disable.pager")},w=function(t,n,r){var s=e(n.cssPageSize,n.container).removeClass(n.cssDisabled).removeAttr("disabled");e(n.container).find(n.cssGoto).removeClass(n.cssDisabled).removeAttr("disabled"),n.isDisabled=!1,n.page=e.data(t,"pagerLastPage")||n.page||0,n.size=e.data(t,"pagerLastSize")||parseInt(s.find("option[selected]").val(),10)||n.size,s.val(n.size),n.totalPages=Math.ceil(Math.min(n.totalPages,n.filteredPages)/n.size),r&&(e(t).trigger("update"),d(t,n.size,n),u(t,n),i(t,n))};t.appender=function(t,n){var r=t.config.pager;r.ajax||(t.config.rowsCopy=n,r.totalRows=n.length,r.size=e.data(t,"pagerLastSize")||r.size,r.totalPages=Math.ceil(r.totalRows/r.size),c(t,n,r))},t.construct=function(n){return this.each(function(){if(!this.config||!this.hasInitialized)return;var i,a,f,l=this.config,c=l.pager=e.extend({},e.tablesorterPager.defaults,n),E=this,S=E.config,x=e(E),T=e(c.container).addClass("tablesorter-pager").show();l.appender=t.appender,x.unbind("filterStart.pager filterEnd.pager sortEnd.pager disable.pager enable.pager destroy.pager update.pager").bind("filterStart.pager",function(e,t){c.currentFilters=t}).bind("filterEnd.pager sortEnd.pager",function(){if(e.data(E,"pagerUpdateTriggered")){e.data(E,"pagerUpdateTriggered",!1);return}c.page=0,r(E,c),p(E,c),s(E,c)}).bind("disable.pager",function(){h(E,c)}).bind("enable.pager",function(){w(E,c,!0)}).bind("destroy.pager",function(){b(E,c)}).bind("update.pager",function(){o(E,c)}),a=[c.cssFirst,c.cssPrev,c.cssNext,c.cssLast],f=[v,y,g,m],T.find(a.join(",")).unbind("click.pager").bind("click.pager",function(t){var n,r=e(this),i=a.length;if(!r.hasClass(c.cssDisabled))for(n=0;n<i;n++)if(r.is(a[n])){f[n](E,c);break}return!1}),T.find(c.cssGoto).length&&(T.find(c.cssGoto).unbind("change").bind("change",function(){c.page=e(this).val()-1,p(E,c)}),r(E,c)),i=T.find(c.cssPageSize),i.length&&i.unbind("change.pager").bind("change.pager",function(){return i.val(e(this).val()),e(this).hasClass(c.cssDisabled)||(d(E,parseInt(e(this).val(),10),c),s(E,c)),!1}),c.initialized=!1,x.trigger("pagerBeforeInitialized",c),w(E,c,!1),typeof c.ajaxUrl=="string"?(c.ajax=!0,S.widgetOptions.filter_serversideFiltering=!0,S.serverSideSorting=!0,p(E,c)):(c.ajax=!1,e(this).trigger("appendCache",!0),u(E,c)),c.ajax||(c.initialized=!0,e(E).trigger("pagerInitialized",c))})}}}),e.fn.extend({tablesorterPager:e.tablesorterPager.construct})})(jQuery);