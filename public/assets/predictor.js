// add commas
function addCommas(e){return numWithCommas=e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),numWithCommas}var chartOptions={chart:{renderTo:"prediction",type:"bar",height:160,backgroundColor:null},title:{text:" ",style:{color:"#FFFFFF"}},subtitle:{text:""},credits:{enabled:!1},xAxis:{labels:{style:{color:"#FFFFFF"}}},yAxis:{min:0,title:{text:"Available Points"}},labels:{formatter:function(){return this.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+this.y+" points"}},plotOptions:{series:{stacking:"normal",events:{legendItemClick:function(e){return!1}}}},legend:{backgroundColor:null,borderColor:null,reversed:!0,itemStyle:{color:"#CCCCCC"}},series:[]},AssignmentType=Backbone.Model.extend(),AssignmentTypesArray=Backbone.Collection.extend({model:AssignmentType}),PredictorView=Backbone.View.extend({el:"#predictorPage",initialize:function(){this.collection=new AssignmentTypesArray,this.createAssignmentTypes(),this.calculateScores(),this.setupChart(),this.collection.bind("change",this.render,this),this.$el=$(this.el),this.render()},render:function(){var e=this.model;e.yAxis[0].setExtremes(0,this.calculateCourseTotal());var t=0;this.collection.forEach(function(n,r){e.series[r].setData([n.get("score")]),t+=n.get("score")}),$("#predictor-score-display").html(addCommas(t)),$("#predictor-course-total-display").html(addCommas(this.calculateCourseTotal())),$("#predictedCourseGrade").html()},createAssignmentTypes:function(){var e=this.collection;$.each(this.$el.find(".slides li").not(".clone"),function(t,n){$slide=$(n);if($slide.attr("id")=="slide-required")return!0;var r=$slide.data("assignment-type-name"),i=$slide.data("assignment-type-id");e.add(new AssignmentType({id:i,name:r,score:0}))})},setupChart:function(){this.collection.forEach(function(e,t){chartOptions.series.push({name:e.get("name"),data:[e.get("score")]})}),chartOptions.xAxis.categories=" ",chartOptions.yAxis.max=this.calculateCourseTotal(),this.model=new Highcharts.Chart(chartOptions)},events:{"change input":"calculateScores","change select":"calculateScores","slidestop .slider":"calculateScores"},calculateCourseTotal:function(){var e=0,t=this.$el.find("li#slide-badges");return $.each(t.find("input"),function(t,n){var r=$(n);r.is(":checked")&&(e+=parseInt(r.val()))}),e+=parseInt(this.$el.data("course-total")),e},calculateScores:function(){var e=this.collection;$.each(this.$el.find(".slides li").not(".clone"),function(t,n){var r=$(n);if(r.attr("id")=="slide-required")return!0;var i=r.data("assignment-type-id"),s=0;$.each(r.find("input, select, .slider"),function(e,t){var n=$(t);n.is(":checkbox")&&n.is(":checked")?s+=parseInt(n.val()):n.is("select")?s+=parseInt(n.children("option:selected").val()||0):n.is('input[type="hidden"]')?s+=parseInt(n.val()):n.is(".ui-slider")&&(s+=parseInt(n.slider("value")))}),e.get(i).set("score",s)})}});$(document).ready(function(){var e=$("#prediction");e.length&&new PredictorView});